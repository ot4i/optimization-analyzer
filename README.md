# optimization-analyzer
A tool to help interpret the results of optimizing the start-up time of an integration server using ibmint

IBM App Connect Enterprise 12.0.4.0 (released March 2022) provided a new capability which help optimize the start-up time of an independent integration server. When using an independent integration server with fixed code and configuration running in a container, it is possible in many cases to reduce the container's start-up time by determining functions of the server which are not required to be started. 

Why is optimization sometimes necessary?
========================================
The Integration Server process is heterogeneous – it contains native C code, a JVM, a CLR (on Windows platforms), and NodeJS. It boasts a huge array of functions and capabilities built up over two decades of investment. However, as deployments become more granular and lightweight, generally the industry is shifting away from the Enterprise Service Bus design pattern, and fewer message flows are being deployed in to each separate integration server container. In this manner containerization is providing solutions with better isolation, better scalability, and better agility.

What does optimization involve?
===============================
In an environment with IBM App Connect Enterprise 12.0.4.0 installed, you can issue a new command: ibmint optimize server
This command generates a new configuration file (named server.components.yaml) which is used when the integration server is started, for selectively “switching off” particular capabilities based on the requirements of what was deployed to the server when the ibmint optimize server command was executed.

How does the optimization command work?
=======================================
For a given container based integration server process, it examines the working directory contents and generates a server.components.yaml file. This file is then used in order to start the integration server with lower CPU requirements.

Where can I find out more about this feature?
=============================================
[IBM Documentation: Optimizing the startup time for an independent integration server](https://www.ibm.com/docs/en/app-connect/12.0?topic=solutions-optimizing-startup-time-independent-integration-server)
[IBM Documentation: ibmint optimize server command](https://www.ibm.com/docs/en/app-connect/12.0?topic=commands-ibmint-optimize-server-command)

Thanks for the quick summary of the feature ... but given all that, what is this repository for?
================================================================================================
If you have a large number of artifacts (Applications, REST APIs, Integration Services, Message flows etc) deployed to an integration server, which you then choose to optimize, it has been reported that some users would find it valuable to know which particular artifacts deployed to that server, caused a particular component of the integration server to be required (ie to be set to true in the server.components.yaml file). Here is an example of a server.components.yaml file which was generated by analyzing a server:

```
---
optimizeComponents: 40
optimizeVersion: '12.0.5.0'
reportExcludedComponents: true
serverComponentsVersion: 1
CLR: false
Deploy: false
JVM: true
NodeJS: true
Nodes: 
  .NET: false
  Aggregation: false
  Basic: false
  CallableFlow: false
  Connector: false
  ESQL: false
  Group: false
  JMSTransform: false
  MQ: false
  REST: false
  SecurityPEP: false
  Timer: false
JavaNodes: 
  Adapters: false
  CICS: false
  CORBA: false
  Collection: false
  Email: false
  File: true
  IMS: false
  JDBC: false
  JMS: false
  JavaCompute: false
  Kafka: false
  MQTT: false
  Mapping: false
  ODM: false
  TCPIP: false
  WSRR: false
  XSLT: false
JavaScriptNodes: 
  LoopBack: false
  Salesforce: false
ResourceManagers: 
  FTE: false
  GlobalCache: false
FlowSecurityProviders: 
  LDAP: false
  TFIM: false
  WS-Trust: false
```

In this example, there is a need for the JavaNodes/File to be switched on, hence the true value shown against the File entry.  If the server in question had tens or hundreds of Applications deployed, it would be useful to know which particular applications cause the need for JavaNodes/File to be switched on.

How does the code in this repository solve the problem?
=======================================================
1. The CreateDeployOptimize.bat script loops over the directory in which it executes searching for BAR files. 
2. For each BAR file discovered, the script creates a work directory, deploys the BAR file in to the work directory, and then runs the ibmint optimize server command against the work directory
3. Once all the BAR files have been looped over, the script invokes a Java program which parses each of the generated server.components.yaml files to determine which aspects of the integration server's capabilities are needed and amalgamates the data into a brief report which shows which BAR file necessitates the need for each functionality.

To help you get started, two BAR files are provided (FileExample.bar and Transformation_XSL.bar). The report which is generated for these two BAR files looks like this:

```
OVERALL RESULTS OF ANALYZING OPTIMIZATIONS AS FOLLOWS ...

CLR: []
Deploy: []
JVM: [FileExample, Transformation_XSL]
NodeJS: [FileExample, Transformation_XSL]
Nodes_Dotnet: []
Nodes_Aggregation: []
Nodes_Basic: []
Nodes_CallableFlow: []
Nodes_Connector: []
Nodes_ESQL: []
Nodes_Group: []
Nodes_JMSTransform: []
Nodes_MQ: []
Nodes_REST: []
Nodes_SecurityPEP: []
Nodes_Timer: []
JavaNodes_Adapters: []
JavaNodes_CICS: []
JavaNodes_CORBA: []
JavaNodes_Collection: []
JavaNodes_Email: []
JavaNodes_File: [FileExample]
JavaNodes_IMS: []
JavaNodes_JDBC: []
JavaNodes_JMS: []
JavaNodes_JavaCompute: []
JavaNodes_Kafka: []
JavaNodes_MQTT: []
JavaNodes_Mapping: []
JavaNodes_ODM: []
JavaNodes_TCPIP: []
JavaNodes_WSRR: []
JavaNodes_XSLT: [Transformation_XSL]
JavaScriptNodes_LoopBack: []
JavaScriptNodes_Salesforce: []
ResourceManagers_FTE: []
ResourceManagers_GlobalCache: []
FlowSecurityProviders_LDAP: []
FlowSecurityProviders_TFIM: []
FlowSecurityProviders_WS_Trust: []

ALL COMPLETE SO EXIT!

```

To use the solution provided in this repository:
================================================
1. git clone https://github.com/ot4i/optimization-analyzer.git
2. On Windows, open an IBM App Connect Enterprise Command Console window (if you are running on a different platform you will need to edit the file CreateDeployOptimize.bat accordingly) and run CreateDeployOptimize.bat
3. Note that CreateDeployOptimize.bat calls com.ibm.dev.AnalyzeOptimizations which requires the Jackson snakeyaml dependency. This dependency comes with your IBM App Connect Enterprise installation. CreateDeployOptimize.bat includes a classpath parameter which assumes that App Connect Enterprise 12.0.5.0 is being used and that it has been installed in to the default product install location. If you have used a different product version (12.0.4.0 or above) or a different install location, you can simply edit CreateDeployOptimize.bat accordingly.
